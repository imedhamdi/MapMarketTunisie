<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description"
    content="MapMarket : trouvez des annonces pr√®s de chez vous sur une carte rapide et accessible.">
  <meta name="theme-color" content="#0f172a">
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; img-src 'self' https://images.unsplash.com https://*.tile.openstreetmap.org https://tile.openstreetmap.org https://via.placeholder.com https://unpkg.com https://mapmarket-images.s3.eu-west-3.amazonaws.com data: blob:; media-src 'self' data: blob: https://mapmarket-images.s3.eu-west-3.amazonaws.com; style-src 'self' 'unsafe-inline' https://unpkg.com; script-src 'self' https://unpkg.com; connect-src 'self' https://nominatim.openstreetmap.org ws://localhost:4000 wss://localhost:4000 http://localhost:4000; font-src 'self'; object-src 'none'; base-uri 'self'">
  <link rel="canonical" href="https://tondomaine.com/">
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://tile.openstreetmap.org" crossorigin>
  <link rel="dns-prefetch" href="https://nominatim.openstreetmap.org">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png">
  <title>MapMarket Tunisie ‚Äî Petites annonces g√©olocalis√©es</title>
  <!-- Leaflet & MarkerCluster -->
  <link rel="preload" as="style" href="./dist/tokens.min.css">
  <link rel="preload" as="style" href="./dist/app.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous">
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <link rel="stylesheet" href="./dist/tokens.min.css">
  <link rel="stylesheet" href="./dist/app.min.css">
  <!-- Modules (drawers de messagerie & profil) -->
  <link rel="stylesheet" href="/css/modules/messages.css">
  <link rel="stylesheet" href="/css/modules/voice-call.css">
  <link rel="stylesheet" href="/css/modules/image-viewer.css">
  <link rel="stylesheet" href="/css/modules/profile.css">
  <link rel="stylesheet" href="/css/modules/join-community.css">
  <script src="./runtime-config.js"></script>
  <!-- Socket.IO client (n√©cessaire pour window.io) -->
  <script src="https://unpkg.com/socket.io-client@4.7.2/dist/socket.io.min.js" integrity="" crossorigin="anonymous"></script>
  <script defer src="/js/voice-call.js"></script>
  <script defer src="/js/messages.js"></script>
  <script defer src="/js/join-community.js"></script>
  <script defer src="/js/why-mapmarket.js"></script>
</head>

<body>
  <header class="header">
    <div class="container nav">
      <a class="brand" href="#">
        <img src="/icons/logo-horizontal.svg" alt="MapMarket" style="height: 40px; width: auto;">
      </a>
      <nav class="nav-actions">
        <a class="nav-link" href="#" id="navMessages"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />
          </svg><span>Messages</span><span class="nav-badge" id="messagesNavBadge" hidden>0</span></a>
        <button class="nav-link pill" type="button" id="openFavs"><svg width="20" height="20" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path
              d="M19 14c1.5-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
          </svg><span>Favoris</span><span class="badge" id="fav-count">0</span></button>
        <button class="cta" id="postBtn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14" />
            <path d="M12 5v14" />
          </svg><span class="hide-sm">D√©poser une annonce</span></button>
        <div class="header-user">
          <div class="avatar" id="avatar"></div>
          <div id="userMenu" class="user-menu" role="menu" aria-labelledby="avatar" hidden>
            <div class="user-menu__header">
              <img class="user-menu__avatar" src="/uploads/avatars/default.jpg" alt="" loading="lazy" decoding="async">
              <div class="user-menu__id">
                <div class="user-menu__name" id="userMenuName">Utilisateur</div>
                <div class="user-menu__email" id="userMenuEmail">email@example.com</div>
              </div>
            </div>
            <button class="user-menu__item" type="button" role="menuitem" data-action="profile">
              <span class="icon">üë§</span>
              <span class="text">
                <strong>Mon Profil</strong>
                <small>Voir et modifier mes informations</small>
              </span>
            </button>
            <hr class="user-menu__sep">
            <button class="user-menu__item danger" type="button" role="menuitem" data-action="logout">
              <span class="icon">üö™</span>
              <span class="text">
                <strong>D√©connexion</strong>
                <small>Se d√©connecter de l‚Äôapplication</small>
              </span>
            </button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Trouvez ce que vous cherchez</h1>
      <p>Des milliers d'articles d'occasion pr√®s de chez vous</p>
    </section>

    <!-- Filters -->
    <section class="card filters-card" aria-label="Filtres">
      <div class="filters-header">
        <div class="filters-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="21" x2="14" y1="4" y2="4" />
            <line x1="10" x2="3" y1="4" y2="4" />
            <line x1="21" x2="12" y1="12" y2="12" />
            <line x1="8" x2="3" y1="12" y2="12" />
            <line x1="21" x2="16" y1="20" y2="20" />
            <line x1="12" x2="3" y1="20" y2="20" />
            <line x1="14" x2="14" y1="2" y2="6" />
            <line x1="8" x2="8" y1="10" y2="14" />
            <line x1="16" x2="16" y1="18" y2="22" />
          </svg>
          <div>
            <p class="filters-heading">Affiner votre recherche</p>
            <p class="filters-subheading">Filtrez par cat√©gorie, prix ou localisation</p>
          </div>
        </div>
        <button class="filters-reset" id="resetBtn" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <polyline points="1 4 1 10 7 10" />
            <polyline points="23 20 23 14 17 14" />
            <path d="M20.49 9A9 9 0 0 0 5 5.55L1 10" />
            <path d="M3.51 15A9 9 0 0 0 19 18.45L23 14" />
          </svg>
          <span>R√©initialiser</span>
        </button>
      </div>
      <div class="filters-grid">
        <div class="filter-field filter-search">
          <label class="filter-label" for="search">Recherche globale</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.3-4.3" />
            </svg>
            <input id="search" type="search" placeholder="Titre, description, mots-cl√©s" autocomplete="off">
          </div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="cat">Cat√©gorie</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="7" rx="1" />
              <rect x="14" y="3" width="7" height="7" rx="1" />
              <rect x="14" y="14" width="7" height="7" rx="1" />
              <rect x="3" y="14" width="7" height="7" rx="1" />
            </svg>
            <select id="cat" title="Cat√©gories">
              <option value="">Toutes cat√©gories</option>
              <option value="immobilier">Immobilier</option>
              <option value="auto">Auto</option>
              <option value="mode">Mode</option>
              <option value="electroniques">High-Tech</option>
              <option value="pieces">Pi√®ces</option>
              <option value="loisirs">Loisirs</option>
            </select>
            <svg class="filter-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="etat">√âtat</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="4 14 8 10 12 14 16 10 20 14" />
              <polyline points="4 8 8 4 12 8 16 4 20 8" />
            </svg>
            <select id="etat" title="√âtat">
              <option value="">Tous √©tats</option>
              <option>Neuf</option>
              <option>Tr√®s bon √©tat</option>
              <option>Bon √©tat</option>
              <option>Correct</option>
            </select>
            <svg class="filter-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="sort">Tri</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h11" />
              <path d="M3 12h7" />
              <path d="M3 18h3" />
              <path d="m15 18 6-6-6-6" />
            </svg>
            <select id="sort" title="Tri">
              <option value="recent">Plus r√©cent</option>
              <option value="priceAsc">Prix croissant</option>
              <option value="priceDesc">Prix d√©croissant</option>
            </select>
            <svg class="filter-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="pmin">Prix minimum (‚Ç¨)</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 3v18" />
              <path d="M17 7H9.5a3.5 3.5 0 0 0 0 7H15a3.5 3.5 0 0 1 0 7H7" />
            </svg>
            <input id="pmin" type="number" min="0" inputmode="numeric" placeholder="Ex. 100">
          </div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="pmax">Prix maximum (‚Ç¨)</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 3v18" />
              <path d="M17 7H9.5a3.5 3.5 0 0 0 0 7H15a3.5 3.5 0 0 1 0 7H7" />
            </svg>
            <input id="pmax" type="number" min="0" inputmode="numeric" placeholder="Ex. 500">
          </div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="city">Ville</label>
          <div class="filter-control">
            <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 10c0 5-5.54 10.2-7.4 11.8a1 1 0 0 1-1.2 0C9.54 20.2 4 15 4 10a8 8 0 0 1 16 0" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            <input id="city" type="text" placeholder="Ex. Paris" autocomplete="off">
          </div>
        </div>
      </div>
    </section>

    <div class="muted results-meta"><span
        id="count"><span class="results-count"><svg class="results-spinner" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.22-8.56"/></svg>Chargement...</span></span>
      <div class="tabs" role="tablist">
        <div class="tab active" role="tab" aria-selected="true" id="tab-list"><svg width="16" height="16"
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M3 12h.01" />
            <path d="M3 18h.01" />
            <path d="M3 6h.01" />
            <path d="M8 12h13" />
            <path d="M8 18h13" />
            <path d="M8 6h13" />
          </svg><span class="hide-sm">Liste</span></div>
        <div class="tab" role="tab" aria-selected="false" id="tab-map"><svg width="16" height="16" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path
              d="M14.1 5.6a2 2 0 0 0 1.8 0l3.7-1.8a1 1 0 0 1 .9.8v12.8a1 1 0 0 1-.6.9l-4.6 2.3a2 2 0 0 1-1.8 0L8.3 18.5a2 2 0 0 0-1.8 0l-3.7 1.8A1 1 0 0 1 2 19.4V6.6a1 1 0 0 1 .6-.9l4.6-2.3a2 2 0 0 1 1.8 0z" />
            <path d="M15 5.8v15" />
            <path d="M9 3.2v15" />
          </svg><span class="hide-sm">Carte</span></div>
      </div>
    </div>

    <!-- Cards / Map views -->
    <div class="view-wrapper show-list" id="viewWrapper" aria-live="polite">
      <section class="results view" aria-hidden="false" aria-label="R√©sultats en liste">
        <div class="grid list-view" id="listView"></div>
        
        <!-- Pagination controls -->
        <div class="pagination-container" id="pager" hidden>
          <button class="pager-button pager-button--prev" id="btnPrevPage" type="button" aria-label="Afficher la page pr√©c√©dente">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="15 6 9 12 15 18"></polyline>
            </svg>
            <span>Pr√©c√©dent</span>
          </button>
          <div class="pager-indicator" id="pagerIndicator" aria-live="polite">1 / 1</div>
          <button class="pager-button pager-button--next" id="btnNextPage" type="button" aria-label="Afficher la page suivante">
            <span>Suivant</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="9 6 15 12 9 18"></polyline>
            </svg>
          </button>
        </div>
        
        <div class="empty-state" id="emptyState" hidden>
          <div class="empty-state-icon" aria-hidden="true">üîç</div>
          <h3 class="empty-state-title">Aucune annonce trouv√©e</h3>
          <p class="empty-state-text">Essayez d'√©largir votre recherche en modifiant les filtres ou la localisation.</p>
          <div class="empty-state-actions">
            <button class="btn-empty-reset" id="btnResetFilters" type="button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" x2="10" y1="11" y2="17"/>
                <line x1="14" x2="14" y1="11" y2="17"/>
              </svg>
              R√©initialiser les filtres
            </button>
            <button class="btn-empty-publish" id="btnPublishFromEmpty" type="button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14"/>
                <path d="M5 12h14"/>
              </svg>
              D√©poser une annonce
            </button>
          </div>
        </div>
      </section>
      <div class="view map-view" id="mapView" role="region" aria-labelledby="tab-map">
        <div id="map"></div>
        <div class="map-bottom-guard" aria-hidden="true"></div>
        <div class="map-fade-bottom" aria-hidden="true"></div>
        <!-- Geo Panel (overlay dans la map) -->
        <div class="geo-panel" id="geoPanel" aria-live="polite">
          <button class="geo-btn" id="geoLocateBtn" type="button" title="Me localiser" aria-live="polite"
            aria-busy="false" aria-expanded="false" aria-controls="geoDropdown">
            <span class="geo-ico" aria-hidden="true">üìç</span>
            <span class="geo-label">Me localiser</span>
            <span class="geo-spinner" aria-hidden="true"></span>
            <span class="geo-caret" id="geoCaretBtn">‚ñæ</span>
            <span class="geo-toast" id="geoToast" role="status" aria-live="polite" hidden>Position d√©tect√©e ‚úÖ</span>
          </button>

          <div class="geo-dropdown geo-dropdown--modern" id="geoDropdown" role="group" aria-label="Options de recherche par rayon" hidden>
            <div class="radius-modern__visual">
              <div class="radius-modern__circle">
                <svg class="radius-modern__pin" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M20 10c0 5-5.54 10.2-7.4 11.8a1 1 0 0 1-1.2 0C9.54 20.2 4 15 4 10a8 8 0 0 1 16 0"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                <div class="radius-modern__value" id="geoRadiusVal">10</div>
                <div class="radius-modern__unit">kilom√®tres</div>
              </div>
            </div>

            <div class="radius-modern__slider" id="geoRadiusRow">
              <input 
                type="range" 
                class="radius-modern__input" 
                id="geoRadius"
                min="1" 
                max="100" 
                step="1" 
                value="10"
                aria-label="Rayon de recherche en kilom√®tres"
              >
              <div class="radius-modern__marks">
                <span class="radius-modern__mark">1 km</span>
                <span class="radius-modern__mark">50 km</span>
                <span class="radius-modern__mark">100 km</span>
              </div>
            </div>

            <label class="radius-modern__toggle geo-toggle" for="geoRadiusEnabled">
              <span class="radius-modern__toggle-label">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="m9 12 2 2 4-4"/>
                </svg>
                <span id="geoToggleText">Recherche par rayon d√©sactiv√©e</span>
              </span>
              <input type="checkbox" id="geoRadiusEnabled" class="hidden-checkbox">
              <span class="toggle-switch"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
    <div id="sentinel"></div>
    <div class="loading" id="loading" hidden>Chargement‚Ä¶</div>
  </main>
  <nav class="bottom-nav" id="bottomNav" aria-label="Navigation mobile">
    <button class="bn-btn is-active" type="button" data-action="home" aria-pressed="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <path d="m3 11 9-8 9 8" />
        <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7" />
      </svg>
      <span class="bn-label">Accueil</span>
    </button>
    <button class="bn-btn" type="button" data-action="messages" aria-pressed="false">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <path
          d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8.5Z" />
      </svg>
      <span class="bn-label">Messages</span>
    </button>
    <button class="bn-cta" type="button" data-action="publish" aria-pressed="false">
      <span class="bn-cta-circle" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 5v14" />
          <path d="M5 12h14" />
        </svg>
      </span>
      <span class="bn-label">Publier</span>
    </button>
    <button class="bn-btn" type="button" data-action="favs" aria-pressed="false">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <path
          d="M19 14c1.5-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
      </svg>
      <span class="bn-label">Favoris</span>
    </button>
    <button class="bn-btn" type="button" data-action="profile" aria-pressed="false">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="7" r="4" />
        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
      </svg>
      <span class="bn-label">Profil</span>
    </button>
  </nav>

  <!-- AUTH MODAL -->
  <div class="modal-backdrop auth-backdrop" id="authModal" aria-hidden="true">
    <div class="auth-dialog" id="authDialog" role="dialog" aria-modal="true" aria-labelledby="heroTitle">
      <div class="auth-hero">
        <div class="auth-header">
          <div class="auth-brand">
            <svg class="pin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 10c0 5-5.54 10.2-7.4 11.8a1 1 0 0 1-1.2 0C9.54 20.2 4 15 4 10a8 8 0 0 1 16 0" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            <strong>MapMarket</strong>
          </div>
        </div>
        <div class="auth-hero-content">
          <h2 id="heroTitle">Bienvenue !</h2>
          <p id="heroSubtitle">Acc√©dez √† vos messages, favoris et alertes personnalis√©es</p>
        </div>
        <div class="auth-hero-illus" id="heroIcon">üìç</div>
      </div>
      <div class="auth-pane">
        <div class="auth-tabs" role="tablist">
          <div class="auth-indicator" id="tabIndicator"></div>
          <button class="auth-tab active" id="loginTab" type="button" role="tab" aria-selected="true">Se
            connecter</button>
          <button class="auth-tab" id="signupTab" type="button" role="tab" aria-selected="false">Cr√©er un
            compte</button>
        </div>

        <div class="auth-forms" id="formContainer">
          <form class="auth-form active" id="loginForm" autocomplete="on" novalidate>
            <div class="auth-group">
              <label class="auth-label" for="loginEmail">Adresse email</label>
              <div class="auth-input-wrapper">
                <input class="auth-input" id="loginEmail" type="email" autocomplete="email"
                  placeholder="vous@exemple.fr" required>
              </div>
            </div>

            <div class="auth-group">
              <label class="auth-label" for="loginPassword">Mot de passe</label>
              <div class="auth-input-wrapper">
                <input class="auth-input" id="loginPassword" type="password" autocomplete="current-password"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                <button type="button" class="password-toggle" data-target="loginPassword"
                  aria-label="Afficher ou masquer le mot de passe">üëÅ</button>
              </div>
            </div>

            <button type="submit" class="auth-submit" id="loginSubmit">Se connecter</button>

            <div class="auth-forgot">
              <button type="button" id="forgotTrigger">Mot de passe oubli√© ?</button>
            </div>
          </form>

          <form class="auth-form" id="signupForm" autocomplete="on" novalidate>
            <div class="auth-group">
              <label class="auth-label" for="signupName">Nom complet</label>
              <div class="auth-input-wrapper">
                <input class="auth-input" id="signupName" type="text" autocomplete="name" placeholder="Jean Dupont"
                  required>
              </div>
            </div>

            <div class="auth-group">
              <label class="auth-label" for="signupEmail">Adresse email</label>
              <div class="auth-input-wrapper">
                <input class="auth-input" id="signupEmail" type="email" autocomplete="email"
                  placeholder="vous@exemple.fr" required>
              </div>
            </div>

            <div class="auth-group">
              <label class="auth-label" for="signupPassword">Mot de passe</label>
              <div class="auth-input-wrapper">
                <input class="auth-input" id="signupPassword" type="password" autocomplete="new-password"
                  placeholder="Minimum 8 caract√®res" minlength="8" required>
                <button type="button" class="password-toggle" data-target="signupPassword"
                  aria-label="Afficher ou masquer le mot de passe">üëÅ</button>
              </div>
            </div>

            <button type="submit" class="auth-submit" id="signupSubmit">Cr√©er mon compte</button>
          </form>

          <form class="auth-form" id="forgotForm" novalidate>
            <div class="auth-group">
              <label class="auth-label" for="forgotEmail">Adresse email</label>
              <div class="auth-input-wrapper">
                <input class="auth-input" id="forgotEmail" type="email" autocomplete="email"
                  placeholder="vous@exemple.fr" required>
              </div>
            </div>

            <button type="submit" class="auth-submit" id="forgotSubmit">Recevoir un mot de passe temporaire</button>

            <div class="auth-forgot">
              <button type="button" id="backToLogin">‚Üê Retour √† la connexion</button>
            </div>
          </form>

        </div>
        <div class="auth-feedback" id="authFeedback" aria-live="polite" aria-atomic="true"></div>

      </div>
      <button class="auth-close" id="closeAuth" aria-label="Fermer">‚úï</button>
    </div>
  </div>

  <!-- POST MODAL -->
  <div class="modal-backdrop post-backdrop" id="postModal" aria-hidden="true">
    <div class="post-dialog" id="postDialog" role="dialog" aria-modal="true" aria-labelledby="postTitle">
      <header class="post-header">
        <div class="post-title-group">
          <h2 id="postTitle">D√©poser une annonce</h2>
          <p class="post-subtitle">Partagez votre article en d√©taillant son √©tat, son prix et sa localisation.</p>
        </div>
        <button class="post-close" id="closePost" type="button" aria-label="Fermer">‚úï</button>
      </header>
      <form id="postForm" class="post-form" novalidate>
        <div class="post-content">
          <section class="post-section" aria-labelledby="postSectionMain">
            <header>
              <h3 id="postSectionMain">A. Infos principales</h3>
              <p class="hint">Soyez pr√©cis: marque, mod√®le, √©tat‚Ä¶</p>
            </header>
            <div class="post-grid">
              <div class="field">
                <label for="postTitleInput">Titre de l‚Äôannonce <span aria-hidden="true">*</span></label>
                <input type="text" id="postTitleInput" name="title" placeholder="Ex: Peugeot 208 2018 Diesel" required minlength="10" maxlength="80" autocomplete="off">
                <p class="field-hint">Entre 10 et 80 caract√®res.</p>
                <p class="field-error" data-error-for="postTitleInput"></p>
              </div>
              <div class="field">
                <label for="postCategory">Cat√©gorie <span aria-hidden="true">*</span></label>
                <select id="postCategory" name="category" required>
                  <option value="">S√©lectionnez</option>
                  <option value="immobilier">Immobilier</option>
                  <option value="auto">Auto</option>
                  <option value="mode">Mode</option>
                  <option value="electroniques">High-Tech</option>
                  <option value="pieces">Pi√®ces</option>
                  <option value="loisirs">Loisirs</option>
                </select>
                <p class="field-error" data-error-for="postCategory"></p>
              </div>
              <div class="field">
                <label for="postCondition">√âtat <span aria-hidden="true">*</span></label>
                <select id="postCondition" name="condition" required>
                  <option value="">S√©lectionnez</option>
                  <option value="new">Neuf</option>
                  <option value="very_good">Tr√®s bon √©tat</option>
                  <option value="good">Bon √©tat</option>
                  <option value="fair">Correct</option>
                </select>
                <p class="field-error" data-error-for="postCondition"></p>
              </div>
              <div class="field">
                <label for="postPrice">Prix (Dt) <span aria-hidden="true">*</span></label>
                <div class="price-input">
                  <input type="number" id="postPrice" name="price" required min="0.1" max="9999999" step="1" inputmode="decimal" placeholder="Ex: 2500">
                  <span class="currency">Dt</span>
                </div>
                <p class="field-error" data-error-for="postPrice"></p>
              </div>
            </div>
          </section>

          <section class="post-section" aria-labelledby="postSectionPhotos">
            <header>
              <h3 id="postSectionPhotos">B. Photos</h3>
              <p class="hint">Ajoutez jusqu‚Äô√† 10 photos nettes sous plusieurs angles.</p>
            </header>
            <div class="uploader" id="postUploader">
              <input type="file" id="postPhotos" name="photos" accept="image/jpeg,image/png,image/webp" multiple hidden>
              <label for="postPhotos" class="uploader-drop" tabindex="0">
                <span class="uploader-illustration">üì∏</span>
                <span class="uploader-text">
                  <strong>Glissez vos photos ici</strong>
                  <span class="uploader-hint">Formats jpg, png, webp ‚Äì 10 max (8 Mo max chacune).</span>
                </span>
              </label>
              <div class="uploader-list" id="postPhotosList" aria-live="polite"></div>
              <p class="field-error" data-error-for="postPhotos"></p>
            </div>
          </section>

          <section class="post-section" aria-labelledby="postSectionAttributes">
            <header>
              <h3 id="postSectionAttributes">C. Caract√©ristiques</h3>
              <p class="hint">Renseignez les informations sp√©cifiques √† votre cat√©gorie.</p>
            </header>
            <div id="postAttributes" class="post-grid"></div>
          </section>

          <section class="post-section" aria-labelledby="postSectionLocation">
            <header>
              <h3 id="postSectionLocation">D. Localisation</h3>
              <p class="hint">Indiquez l‚Äôemplacement pour des r√©sultats locaux pertinents.</p>
            </header>
            <div class="post-grid">
              <div class="field field-col">
                <label for="postAddress">Adresse <span aria-hidden="true">*</span></label>
                <input
                  type="text"
                  id="postAddress"
                  name="locationText"
                  placeholder="Ville / adresse‚Ä¶"
                  autocomplete="off"
                  required
                  readonly
                >
                <p class="field-error" data-error-for="postAddress"></p>
              </div>
            </div>
            <div class="map-wrapper">
              <div class="map-toolbar">
                <button type="button" class="map-btn" id="postUseLocation">üìç Utiliser ma position</button>
                <p class="map-hint">D√©placez le marqueur pour ajuster la position.</p>
              </div>
              <div id="postMap" class="post-map" role="application" aria-label="Carte de localisation"></div>
              <div class="map-coords" id="mapCoords">
                Latitude: <span id="coordsLat">--</span> | Longitude: <span id="coordsLng">--</span>
              </div>
              <input type="hidden" id="postLat" name="latitude">
              <input type="hidden" id="postLng" name="longitude">
            </div>
          </section>

          <section class="post-section" aria-labelledby="postSectionDescription">
            <header>
              <h3 id="postSectionDescription">E. Description</h3>
              <p class="hint">D√©crivez l‚Äôarticle: √©tat r√©el, accessoires, facture, raison de la vente‚Ä¶</p>
            </header>
            <div class="field field-col">
              <label for="postDescription">Description <span aria-hidden="true">*</span></label>
              <textarea id="postDescription" name="description" rows="6" minlength="30" maxlength="2000" required placeholder="Donnez un maximum de d√©tails pour rassurer les acheteurs."></textarea>
              <div class="field-footer">
                <p class="field-hint">Minimum 30 caract√®res ¬∑ Maximum 2000 caract√®res.</p>
                <span id="postDescriptionCount" aria-live="polite">0 / 2000</span>
              </div>
              <p class="field-error" data-error-for="postDescription"></p>
            </div>
          </section>

          <div class="post-section post-section--draft" aria-live="polite" hidden id="postDraftBanner">
            <div class="draft-banner">
              <div class="draft-info">
                <strong>Brouillon retrouv√©</strong>
                <p>Vous aviez commenc√© une annonce. Voulez-vous la reprendre ?</p>
              </div>
              <div class="draft-actions">
                <button type="button" class="mm-btn" id="postDraftResume">Charger</button>
                <button type="button" class="mm-btn ghost" id="postDraftDiscard">Ignorer</button>
              </div>
            </div>
          </div>
        </div>

        <footer class="post-footer">
          <div class="footer-left">
            <button type="button" class="mm-btn ghost" id="postCancel">Annuler</button>
            <button type="button" class="mm-btn outline" id="postPreview">Pr√©visualiser</button>
            <button type="button" class="mm-btn ghost" id="postSaveDraft">Enregistrer le brouillon</button>
          </div>
          <div class="footer-right">
            <div class="post-status" id="postStatus" aria-live="polite"></div>
            <button type="submit" class="mm-btn primary" id="postSubmit">
              <span class="btn-label">Publier l‚Äôannonce</span>
              <span class="btn-spinner" aria-hidden="true"></span>
            </button>
          </div>
        </footer>
      </form>
    </div>
  </div>

  <!-- DETAILS MODAL -->
  <div class="modal-backdrop details-backdrop" id="detailsModal" aria-hidden="true">
    <div class="details-dialog" id="detailsDialog" role="dialog" aria-modal="true" aria-labelledby="detailsTitle">
      <button
        class="details-share"
        id="shareDetails"
        type="button"
        aria-label="Partager"
        title="Partager l'annonce"
        disabled
      >
        <svg
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          aria-hidden="true"
          focusable="false"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M14.4613 6.16913L14.4615 6.20097L7.5446 9.07413C7.01557 8.79113 6.41114 8.63067 5.76923 8.63067C3.68754 8.63067 2 10.3182 2 12.3999C2 14.4816 3.68754 16.1691 5.76923 16.1691C6.41112 16.1691 7.01554 16.0087 7.54456 15.7257L14.4615 18.5989C14.4614 18.6095 14.4613 18.6201 14.4613 18.6307C14.4613 20.7124 16.1489 22.3999 18.2306 22.3999C20.3123 22.3999 21.9998 20.7124 21.9998 18.6307C21.9998 16.549 20.3123 14.8614 18.2306 14.8614C16.8699 14.8614 15.6777 15.5824 15.015 16.6631L9.08232 14.1988C9.3732 13.6642 9.53846 13.0513 9.53846 12.3999C9.53846 11.7485 9.3732 11.1357 9.08233 10.6011L15.015 8.13671C15.6777 9.21743 16.87 9.93836 18.2306 9.93836C20.3123 9.93836 21.9998 8.25082 21.9998 6.16913C21.9998 4.08744 20.3123 2.3999 18.2306 2.3999C16.1489 2.3999 14.4613 4.08744 14.4613 6.16913ZM18.2306 4.3999C17.2534 4.3999 16.4613 5.19201 16.4613 6.16913C16.4613 6.29455 16.4744 6.41692 16.4992 6.53496C16.5118 6.57489 16.5217 6.61511 16.529 6.65544C16.7403 7.39609 17.4221 7.93836 18.2306 7.93836C19.2077 7.93836 19.9998 7.14625 19.9998 6.16913C19.9998 5.19201 19.2077 4.3999 18.2306 4.3999ZM6.8872 13.7712C7.28467 13.4468 7.53846 12.953 7.53846 12.3999C7.53846 11.8469 7.28478 11.3532 6.88745 11.0288C6.85405 11.0064 6.82192 10.982 6.79127 10.9556C6.50263 10.7509 6.14997 10.6307 5.76923 10.6307C4.79211 10.6307 4 11.4228 4 12.3999C4 13.377 4.79211 14.1691 5.76923 14.1691C6.15008 14.1691 6.50282 14.0488 6.79151 13.8441C6.82201 13.8178 6.85398 13.7935 6.8872 13.7712ZM16.4992 18.265C16.5118 18.225 16.5217 18.1847 16.529 18.1443C16.7403 17.4037 17.4221 16.8614 18.2306 16.8614C19.2077 16.8614 19.9998 17.6536 19.9998 18.6307C19.9998 19.6078 19.2077 20.3999 18.2306 20.3999C17.2534 20.3999 16.4613 19.6078 16.4613 18.6307C16.4613 18.5053 16.4744 18.383 16.4992 18.265Z"
          ></path>
        </svg>
      </button>

      <button class="details-close" id="closeDetails" aria-label="Fermer">‚úï</button>

      <div class="details-media">
        <div class="details-carousel">
          <div class="carousel-track" id="detailsCarouselTrack"></div>
          <div class="carousel-nav">
            <button class="carousel-btn" id="detailsPrev" aria-label="Image pr√©c√©dente">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6" />
              </svg>
            </button>
            <button class="carousel-btn" id="detailsNext" aria-label="Image suivante">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6" />
              </svg>
            </button>
          </div>
          <div class="carousel-meta">
            <div class="carousel-counter" id="detailsImageCounter">1 / 1</div>
            <div class="carousel-dots" id="detailsCarouselDots"></div>
          </div>
          <div class="details-meta details-meta-category" role="group" aria-label="Cat√©gorie de l'annonce"></div>
          <div class="details-meta details-meta-stats" role="group" aria-label="Statistiques de l'annonce"></div>
        </div>
        <div class="details-skeleton" id="detailsSkeleton"></div>
      </div>

      <div class="details-body">
        <div class="details-hero-card">
          <div class="details-hero-info">
            <h2 id="detailsTitle">Titre</h2>
            <div class="details-meta" id="detailsMeta"></div>
          </div>
          <div class="details-price" id="detailsPrice"><strong>‚Äî</strong></div>
        </div>

        <div class="details-tags" id="detailsTags"></div>

        <section class="details-section">
          <h3>Description</h3>
          <p class="details-desc" id="detailsDesc"></p>
          <button class="details-readmore" id="detailsReadMore" type="button">Lire la suite</button>
        </section>

        <section class="details-section">
          <h3>Informations sur le vendeur</h3>
          <div class="seller-card-wrap" id="sellerCardWrap">
            <div class="seller-card" id="detailsSeller"></div>
            <div id="contactPopover" class="contact-popover" hidden role="dialog" aria-modal="true" aria-labelledby="cpTitle">
              <div class="contact-arrow" aria-hidden="true"></div>
              <header class="contact-header">
                <h3 id="cpTitle">Contacter le vendeur</h3>
                <button id="cpClose" class="icon-btn contact-close" type="button" aria-label="Fermer">‚úï</button>
              </header>
              <div class="contact-body">
                <textarea id="cpMessage" rows="3" maxlength="500"
                  placeholder="Bonjour, votre article est-il toujours disponible ? Puis-je venir le voir ce week-end ?"></textarea>
                <p id="cpError" class="cp-error" role="alert" aria-live="assertive" hidden></p>
                <div class="contact-footer">
                  <span id="cpCounter" class="cp-counter" aria-live="polite">500</span>
                  <div class="cp-actions">
                    <button class="icon-btn ghost" id="cpCancel" type="button" aria-label="Annuler" title="Annuler">‚úï</button>
                    <button class="icon-btn primary" id="cpSend" type="button" aria-label="Envoyer" title="Envoyer">
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M22 2L11 13" />
                        <path d="M22 2L15 22l-4-9-9-4Z" />
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <div class="details-actions">
          <button class="cta-outline" id="detailsSave" type="button" aria-label="Ajouter aux favoris">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path
                d="M19 14c1.5-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
            </svg>
            <span>Ajouter aux favoris</span>
          </button>
          <button class="cta-primary" id="detailsContact" type="button" aria-label="Contacter le vendeur">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M22 12h-4" />
              <path d="M2 12h4" />
              <path d="M12 2v4" />
              <path d="M12 22v-4" />
              <rect x="7" y="7" width="10" height="10" rx="2" />
            </svg>
            <span>Contacter</span>
          </button>
          <button class="cta-secondary" id="detailsVisit" type="button" aria-label="Voir sur la carte">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M12 19V6" />
              <path d="m5 12 7-7 7 7" />
            </svg>
            <span>Voir sur la carte</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="mm-confirm" id="confirmModal" hidden>
    <div class="mm-confirm__backdrop" data-action="dismiss"></div>
    <div class="mm-confirm__dialog" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
      <div class="mm-confirm__icon" aria-hidden="true">üí≠</div>
      <div class="mm-confirm__copy">
        <h3 id="confirmTitle" class="mm-confirm__title">Confirmation</h3>
        <p id="confirmMessage" class="mm-confirm__message">√ätes-vous s√ªr ?</p>
      </div>
      <div class="mm-confirm__actions">
        <button type="button" class="mm-confirm__btn mm-confirm__btn--ghost" data-action="cancel">Annuler</button>
        <button type="button" class="mm-confirm__btn mm-confirm__btn--primary" data-action="confirm">Oui</button>
      </div>
    </div>
  </div>

  <div class="lightbox" id="imageLightbox" hidden>
    <div class="lightbox__backdrop" data-action="dismiss"></div>
    <div class="lightbox__dialog" role="dialog" aria-modal="true" aria-labelledby="lightboxTitle" tabindex="-1">
      <button type="button" class="lightbox__close" data-action="close" aria-label="Fermer l'image">‚úï</button>
      <div class="lightbox__stage">
        <button type="button" class="lightbox__nav lightbox__nav--prev" data-action="prev" aria-label="Image pr√©c√©dente">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6" />
          </svg>
        </button>
        <img id="lightboxImage" src="data:image/gif;base64,R0lGODlhAQABAAAAACw=" alt="" draggable="false" loading="lazy" decoding="async">
        <button type="button" class="lightbox__nav lightbox__nav--next" data-action="next" aria-label="Image suivante">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6" />
          </svg>
        </button>
      </div>
      <div class="lightbox__footer">
        <span class="lightbox__title" id="lightboxTitle"></span>
        <span class="lightbox__counter" id="lightboxCounter"></span>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Action enregistr√©e</div>

  <!-- FAVORITES MODAL (UNIQUE) -->
  <div id="favOverlay" class="mm-overlay" hidden></div>
  <div id="favModal" class="mm-modal" role="dialog" aria-modal="true" aria-labelledby="favTitle" aria-hidden="true">
    <header class="mm-header">
      <div class="mm-header-row">
        <h2 id="favTitle">Favoris <span id="favSheetCount" class="mm-count">0</span></h2>
        <div class="mm-actions">
          <button id="clearAllFavs" class="mm-link danger" type="button">Tout retirer</button>
          <button id="closeFavs" class="mm-icon" aria-label="Fermer" type="button">‚úï</button>
        </div>
      </div>
      <div class="mm-toolbar">
        <div class="mm-search">
          <span class="mm-search-ico">üîé</span>
          <input id="favSearch" type="search" placeholder="Rechercher un favori‚Ä¶" autocomplete="off">
          <button id="favSearchClear" type="button" class="mm-search-clear" aria-label="Effacer la recherche" hidden>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
              <line x1="6" y1="6" x2="18" y2="18" />
              <line x1="6" y1="18" x2="18" y2="6" />
            </svg>
          </button>
        </div>
        <div class="mm-filters">
          <select id="favSortBy" aria-label="Trier">
            <option value="recent">Plus r√©cent</option>
            <option value="price_asc">Prix croissant</option>
            <option value="price_desc">Prix d√©croissant</option>
            <option value="title_asc">Titre A‚ÜíZ</option>
          </select>
          <select id="favByCat" aria-label="Cat√©gorie (toutes)">
            <option value="">Toutes cat√©gories</option>
          </select>
        </div>
      </div>
    </header>
    <div id="favList" class="mm-grid" role="list"></div>
    <div id="favEmptyState" class="mm-empty" hidden>
      <div class="mm-empty-illu">üíó</div>
      <h3>Aucun favori pour l‚Äôinstant</h3>
      <p>Ajoutez des annonces √† vos favoris pour les retrouver ici.</p>
    </div>
  </div>

  <!-- MESSAGES MODAL & OVERLAY -->
  <div id="messagesOverlay" class="mm-overlay" hidden></div>
  <div class="mm-modal mm-modal--messages" id="messagesModal" role="dialog" aria-modal="true" aria-labelledby="messagesTitle" aria-hidden="true">
    <header class="mm-header messages-header">
      <div class="messages-header__row">
        <h2 class="mm-title" id="messagesTitle">Messages <span class="messages-header__badge" id="messagesUnreadBadge"></span></h2>
        <button type="button" class="mm-icon messages-header__close" id="messagesClose" aria-label="Fermer">
          <svg class="messages-icon messages-icon--close" aria-hidden="true" focusable="false">
            <use href="/icons/messages-icons.svg#icon-close"></use>
          </svg>
        </button>
      </div>
    </header>
    <div class="messages-drawer__content">
      <div class="messages-drawer__body">
        <div class="messages-layout" id="messagesLayout">
          <!-- Sidebar conversations -->
          <aside class="messages-sidebar" id="messagesSidebar">
            <div class="messages-sidebar__header">
              <div class="messages-sidebar__intro">
                <h3 class="messages-sidebar__title">Conversations</h3>
                <p class="messages-sidebar__hint">Restez en contact avec les vendeurs et acheteurs.</p>
              </div>
              <div class="messages-search">
                <span class="messages-search__icon" aria-hidden="true">
                  <svg class="messages-icon messages-icon--search" aria-hidden="true" focusable="false">
                    <use href="/icons/messages-icons.svg#icon-search"></use>
                  </svg>
                </span>
                <input id="messagesSearch" type="search" placeholder="Recherche‚Ä¶" autocomplete="off">
                <button type="button" class="messages-search__clear" id="messagesSearchClear" aria-label="Effacer la recherche" hidden>
                  <svg class="messages-icon messages-icon--close" aria-hidden="true" focusable="false">
                    <use href="/icons/messages-icons.svg#icon-close"></use>
                  </svg>
                </button>
              </div>
            </div>
            <div class="conversations-list" id="conversationsList" aria-live="polite"></div>
          </aside>
          <!-- Chat panel -->
          <section class="chat-panel chat-panel--hidden" id="chatPanel" aria-labelledby="chatTitle" aria-live="polite">
            <div class="chat-panel__header">
              <button type="button" class="chat-panel__back" id="chatBack" aria-label="Retour">
                <svg class="messages-icon messages-icon--back" aria-hidden="true" focusable="false">
                  <use href="/icons/messages-icons.svg#icon-back"></use>
                </svg>
              </button>
              <button type="button" class="chat-panel__ad-thumb" id="chatAdThumb" hidden aria-label="Voir l'annonce">
                <svg class="messages-icon" aria-hidden="true" focusable="false">
                  <use href="/icons/messages-icons.svg#icon-image"></use>
                </svg>
              </button>
              <div class="chat-panel__info">
                <h3 class="chat-panel__title" id="chatTitle">S√©lectionnez une conversation</h3>
                <p class="chat-panel__subtitle" id="chatSubtitle">En attente‚Ä¶</p>
                <p class="chat-panel__status" id="chatAdStatus" hidden>Annonce archiv√©e</p>
              </div>
              <button type="button" class="messages-header__call-btn" id="chatCallBtn" aria-label="Appeler" hidden>
                <svg class="messages-icon messages-icon--phone" aria-hidden="true" focusable="false">
                  <use href="/icons/messages-icons.svg#icon-phone"></use>
                </svg>
              </button>
              <button type="button" class="chat-panel__delete" id="chatDelete" aria-label="Supprimer / masquer" hidden>
                <svg class="messages-icon messages-icon--delete" aria-hidden="true" focusable="false">
                  <use href="/icons/messages-icons.svg#icon-delete"></use>
                </svg>
              </button>
            </div>
            <div class="chat-panel__banner" id="chatSecurityBanner" hidden>
              <p class="chat-panel__banner-text"><strong>Rappel s√©curit√©</strong> Ne partagez jamais d‚Äôinformations sensibles (IBAN, codes). Utilisez la messagerie pour fixer un rendez-vous en lieu s√ªr.</p>
              <button type="button" class="chat-panel__banner-close" id="chatBannerClose">Compris</button>
            </div>
            <div class="chat-call-consent" id="chatCallConsent" hidden>
              <div class="chat-call-consent__status" aria-live="polite">
                <span class="chat-call-consent__pill" id="chatCallConsentSelf">
                  <span class="chat-call-consent__dot" aria-hidden="true"></span>
                  <span class="chat-call-consent__label">Vous</span>
                </span>
                <span class="chat-call-consent__pill" id="chatCallConsentOther">
                  <span class="chat-call-consent__dot" aria-hidden="true"></span>
                  <span class="chat-call-consent__label" id="chatCallConsentOtherLabel">Interlocuteur</span>
                </span>
              </div>
              <label class="chat-call-consent__toggle" for="chatCallConsentToggle">
                <input type="checkbox" id="chatCallConsentToggle" class="chat-call-consent__checkbox">
                <span class="chat-call-consent__switch" aria-hidden="true"></span>
                <span class="chat-call-consent__text">Autoriser les appels vocaux</span>
              </label>
              <p class="chat-call-consent__hint" id="chatCallConsentHint" aria-live="polite">Activez les appels apr√®s accord mutuel.</p>
            </div>
            <div class="chat-panel__messages-wrapper">
              <span id="chatMessagesLabel" class="sr-only">Historique des messages</span>
              <div class="chat-panel__messages" id="chatMessages" tabindex="0" role="log" aria-live="polite" aria-relevant="additions text" aria-labelledby="chatMessagesLabel"></div>
              <div class="mm-typing" id="typingIndicator" hidden role="status" aria-live="polite">
                <span class="mm-typing__avatar" aria-hidden="true"></span>
                <div class="mm-typing__bubble">
                  <span class="mm-typing__dots" aria-hidden="true">
                    <span></span>
                    <span></span>
                    <span></span>
                  </span>
                  <span class="mm-typing__text">Votre interlocuteur est en train d'√©crire‚Ä¶</span>
                </div>
              </div>
              <button type="button" class="mm-scroll-bottom" id="scrollToBottom" aria-hidden="true">Bas ‚Üì</button>
            </div>
            <div class="chat-panel__input" id="chatInputArea">
              <div class="chat-panel__attachments" id="chatAttachmentPreview" hidden></div>
              <div class="chat-panel__voice-status" id="chatVoiceStatus" hidden>
                <span class="chat-panel__voice-dot" aria-hidden="true"></span>
                <span class="chat-panel__voice-timer" id="chatVoiceTimer">00:00</span>
                <button type="button" class="chat-panel__voice-cancel" id="chatVoiceCancel">Annuler</button>
              </div>
              <div class="chat-panel__input-row">
                <button type="button" class="chat-panel__attach" id="chatAttachBtn" aria-label="Ajouter une pi√®ce jointe">
                  <svg class="messages-icon messages-icon--attach" aria-hidden="true" focusable="false">
                    <use href="/icons/messages-icons.svg#icon-attach"></use>
                  </svg>
                </button>
                <button type="button" class="chat-panel__voice" id="chatVoiceBtn" aria-label="Enregistrer un message vocal" aria-pressed="false">
                  <svg class="messages-icon messages-icon--mic" aria-hidden="true" focusable="false">
                    <use href="/icons/messages-icons.svg#icon-mic"></use>
                  </svg>
                </button>
                <div class="chat-panel__input-field">
                  <textarea id="chatTextarea" rows="2" maxlength="2000" placeholder="√âcrivez votre message‚Ä¶" aria-label="√âcrire un message"></textarea>
                  <p class="chat-panel__input-note" id="chatInputNote" hidden>Limite atteinte</p>
                </div>
                <button type="button" class="chat-panel__send" id="chatSend" aria-label="Envoyer" disabled>
                  <span class="chat-panel__send-icon" aria-hidden="true">
                    <svg class="messages-icon messages-icon--send" aria-hidden="true" focusable="false">
                      <use href="/icons/messages-icons.svg#icon-send"></use>
                    </svg>
                  </span>
                  <span class="sr-only">Envoyer</span>
                </button>
              </div>
              <input type="file" id="chatFileInput" class="chat-panel__file-input" accept="image/jpeg,image/png,image/webp" multiple hidden>
            </div>
          </section>
          <!-- Nouvel √©tat vide conversations (style favoris) -->
          <div class="mm-empty" id="conversationsEmpty" hidden>
            <div class="mm-empty-illu">üí¨</div>
            <h3 class="mm-empty-title">Aucune conversation pour le moment</h3>
            <p class="mm-empty-text">Contactez un vendeur pour d√©marrer une conversation !</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- VOICE CALL MODAL -->
  <div id="voiceCallModal" class="voice-call-modal hidden">
    <div class="voice-call-content">
      <div class="voice-call-avatar" id="voiceCallAvatar">
        <img src="/uploads/avatars/default.jpg" alt="Avatar">
      </div>
      <h3 class="voice-call-username" id="voiceCallUsername">Utilisateur</h3>
      <p class="voice-call-status" id="voiceCallStatus">En attente...</p>
      <div class="voice-call-connecting" id="voiceCallConnecting" hidden>
        <span class="voice-call-connecting-dot"></span>
        <span class="voice-call-connecting-dot"></span>
        <span class="voice-call-connecting-dot"></span>
      </div>
      <div class="voice-call-duration" id="voiceCallDuration" hidden>00:00</div>
      <div class="voice-call-controls" id="voiceCallControls">
        <button type="button" class="voice-call-btn voice-call-btn--answer" id="voiceCallAnswer" hidden aria-label="R√©pondre">
          <svg class="messages-icon messages-icon--phone" aria-hidden="true" focusable="false">
            <use href="/icons/messages-icons.svg#icon-phone"></use>
          </svg>
        </button>
        <button type="button" class="voice-call-btn voice-call-btn--mute" id="voiceCallMute" hidden aria-label="Couper le micro">
          <svg class="messages-icon messages-icon--mic" aria-hidden="true" focusable="false">
            <use href="/icons/messages-icons.svg#icon-mic"></use>
          </svg>
        </button>
        <button type="button" class="voice-call-btn voice-call-btn--end" id="voiceCallEnd" aria-label="Raccrocher">
          <svg class="messages-icon messages-icon--phone-off" aria-hidden="true" focusable="false">
            <use href="/icons/messages-icons.svg#icon-phone-off"></use>
          </svg>
        </button>
      </div>
    </div>
  <audio id="voiceCallRemoteAudio" class="voice-call-remote-audio" autoplay></audio>
  </div>

  <!-- IMAGE VIEWER -->
  <div id="imageViewer" class="image-viewer" hidden>
    <div class="image-viewer__overlay"></div>
    <div class="image-viewer__content">
      <button type="button" class="image-viewer__close" id="imageViewerClose" aria-label="Fermer">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
  <img id="imageViewerImg" class="image-viewer__img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" alt="">
    </div>
  </div>

  <!-- Recently Viewed Section -->
  <section class="recently-viewed-section" id="recentlyViewedSection" hidden>
    <div class="recently-viewed-header">
      <h2 class="recently-viewed-title">Vous avez r√©cemment vu</h2>
      <button
        class="recently-viewed-clear"
        type="button"
        id="recentlyViewedClear"
        data-label="Effacer l'historique"
        data-loading-label="Nettoyage..."
        hidden
      >
        Effacer l'historique
      </button>
    </div>
    <div class="container">
      <div class="recently-viewed-carousel">
        <button class="carousel-nav carousel-nav--prev" id="recentlyViewedPrev" aria-label="Annonces pr√©c√©dentes">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 6 9 12 15 18"></polyline>
          </svg>
        </button>
        <div class="carousel-track-wrapper">
          <div class="carousel-track" id="recentlyViewedTrack"></div>
        </div>
        <button class="carousel-nav carousel-nav--next" id="recentlyViewedNext" aria-label="Annonces suivantes">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 6 15 12 9 18"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </section>

  <!-- Section "Rejoignez la communaut√©" -->
  <section class="join-community" id="joinCommunity">
    <div class="join-community__container">
      <div class="join-community__wrapper">
        <!-- Content -->
        <div class="join-community__content">
          <p class="join-community__eyebrow">Rejoignez-nous</p>
          
          <h2 class="join-community__title">
            Publiez gratuitement et vendez plus vite
          </h2>
          
          <p class="join-community__description">
            Rejoignez des milliers de vendeurs de confiance et donnez de la visibilit√© √† vos annonces localement.
          </p>
          
          <ul class="join-community__features">
            <li class="join-community__feature">
              <svg class="join-community__feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Publication illimit√©e et gratuite</span>
            </li>
            <li class="join-community__feature">
              <svg class="join-community__feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Visibilit√© locale maximale</span>
            </li>
            <li class="join-community__feature">
              <svg class="join-community__feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Messagerie int√©gr√©e et s√©curis√©e</span>
            </li>
          </ul>
          
          <button type="button" class="join-community__cta" id="joinCommunityBtn">
            <span>Cr√©er un compte</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"></path>
            </svg>
          </button>
          
          <p class="join-community__note">
            Aucune carte bancaire requise ‚Ä¢ Inscription en 30 secondes
          </p>
        </div>
        
        <!-- Visual Card -->
        <div class="join-community__visual">
          <div class="join-community__card">
            <div class="join-community__card-header">
              <div class="join-community__avatar-group">
                <img 
                  src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop" 
                  alt="Utilisateur" 
                  class="join-community__avatar"
                  loading="lazy"
                >
                <img 
                  src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop" 
                  alt="Utilisateur" 
                  class="join-community__avatar"
                  loading="lazy"
                >
                <img 
                  src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop" 
                  alt="Utilisateur" 
                  class="join-community__avatar"
                  loading="lazy"
                >
              </div>
            </div>
            
            <h3 class="join-community__card-title">
              Une communaut√© active
            </h3>
            
            <p class="join-community__card-subtitle">
              Vendeurs et acheteurs se connectent chaque jour pour √©changer en toute confiance.
            </p>
            
            <div class="join-community__stats">
              <div class="join-community__stat">
                <div class="join-community__stat-value" data-counter="1250">0</div>
                <div class="join-community__stat-label">Membres</div>
              </div>
              <div class="join-community__stat">
                <div class="join-community__stat-value" data-counter="3500">0</div>
                <div class="join-community__stat-label">Annonces</div>
              </div>
              <div class="join-community__stat">
                <div class="join-community__stat-value">98%</div>
                <div class="join-community__stat-label">Satisfaits</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section "Pourquoi MapMarket ?" -->
  <section class="why-mapmarket" id="whyMapmarket">
    <div class="why-mapmarket__container">
      <header class="why-mapmarket__header">
        <h2 class="why-mapmarket__title">Pourquoi MapMarket ?</h2>
        <p class="why-mapmarket__subtitle">Une plateforme con√ßue pour simplifier vos recherches et valoriser vos annonces</p>
      </header>

      <div class="why-mapmarket__grid">
        <!-- Card 1: Rapide et simple -->
        <article class="why-mapmarket__card">
          <div class="why-mapmarket__icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <div class="why-mapmarket__content">
            <h3 class="why-mapmarket__card-title">Rapide et simple</h3>
            <p class="why-mapmarket__card-description">Publiez une annonce en moins de 2 minutes. Interface intuitive et processus optimis√©.</p>
            <span class="why-mapmarket__stat">‚ö° 2 min moyenne</span>
          </div>
        </article>

        <!-- Card 2: Localis√© -->
        <article class="why-mapmarket__card">
          <div class="why-mapmarket__icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </div>
          <div class="why-mapmarket__content">
            <h3 class="why-mapmarket__card-title">Localis√©</h3>
            <p class="why-mapmarket__card-description">Trouvez des offres autour de vous gr√¢ce √† notre carte interactive et g√©olocalisation pr√©cise.</p>
            <span class="why-mapmarket__stat">üìç GPS int√©gr√©</span>
          </div>
        </article>

        <!-- Card 3: Fiable -->
        <article class="why-mapmarket__card">
          <div class="why-mapmarket__icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
          </div>
          <div class="why-mapmarket__content">
            <h3 class="why-mapmarket__card-title">Fiable</h3>
            <p class="why-mapmarket__card-description">Comptes v√©rifi√©s et mod√©ration active pour garantir la qualit√© et la s√©curit√©.</p>
            <span class="why-mapmarket__stat">‚úì 100% s√©curis√©</span>
          </div>
        </article>

        <!-- Card 4: Communication directe -->
        <article class="why-mapmarket__card">
          <div class="why-mapmarket__icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <div class="why-mapmarket__content">
            <h3 class="why-mapmarket__card-title">Communication directe</h3>
            <p class="why-mapmarket__card-description">Discutez avec les vendeurs en temps r√©el via notre syst√®me de messagerie int√©gr√©.</p>
            <span class="why-mapmarket__stat">üí¨ Chat en temps r√©el</span>
          </div>
        </article>
      </div>

      <!-- Statistiques -->
      <div class="why-mapmarket__stats">
        <div class="why-mapmarket__stats-item">
          <span class="why-mapmarket__stats-value" data-counter="1250">0</span>
          <span class="why-mapmarket__stats-label">Utilisateurs actifs</span>
        </div>
        <div class="why-mapmarket__stats-item">
          <span class="why-mapmarket__stats-value" data-counter="3500">0</span>
          <span class="why-mapmarket__stats-label">Annonces publi√©es</span>
        </div>
        <div class="why-mapmarket__stats-item">
          <span class="why-mapmarket__stats-value" data-counter="98">0</span>
          <span class="why-mapmarket__stats-label">Taux de satisfaction</span>
        </div>
        <div class="why-mapmarket__stats-item">
          <span class="why-mapmarket__stats-value" data-counter="24">0</span>
          <span class="why-mapmarket__stats-label">Support 24/7</span>
        </div>
      </div>
    </div>
  </section>

  <footer class="mm-footer" id="appFooter">
    <div class="mm-footer__grid">
      <div class="mm-footer__brand">
        <div class="mm-footer__logo">üìç <strong>MapMarket</strong></div>
        <p class="mm-footer__baseline">Trouvez, comparez et localisez les meilleures offres pr√®s de vous.</p>
      </div>

      <nav class="mm-footer__col" aria-label="Produits">
        <h3 class="mm-footer__title">Produits</h3>
        <ul class="mm-footer__links">
          <li><a href="#" data-nav="map">Carte</a></li>
          <li><a href="#" data-nav="list">Liste</a></li>
          <li><a href="#" data-nav="pro">Professionnels</a></li>
        </ul>
      </nav>

      <nav class="mm-footer__col" aria-label="L√©gal">
        <h3 class="mm-footer__title">L√©gal</h3>
        <ul class="mm-footer__links">
          <li><a href="#" data-legal="terms">Conditions d‚Äôutilisation</a></li>
          <li><a href="#" data-legal="privacy">Confidentialit√©</a></li>
          <li><a href="#" data-legal="cookies">Cookies</a></li>
        </ul>
      </nav>

      <div class="mm-footer__col">
        <h3 class="mm-footer__title">Restez inform√©</h3>
        <form id="newsletterForm" class="mm-news" novalidate>
          <label class="sr-only" for="newsletterEmail">Votre e-mail</label>
          <input id="newsletterEmail" class="mm-news__input" type="email" inputmode="email" placeholder="you@example.com" required>
          <button class="mm-news__btn" type="submit">S‚Äôinscrire</button>
          <p class="mm-footer__hint">En vous inscrivant, vous acceptez de recevoir nos actualit√©s. Consultez notre <a href="#"
              data-legal="privacy">Politique de confidentialit√©</a>.</p>
        </form>
      </div>
    </div>
    <div class="mm-footer__copy">¬© <span id="yearNow"></span> MapMarket. Tous droits r√©serv√©s.</div>
  </footer>

  <div id="legalModal" class="mm-modal mm-modal--legal" role="dialog" aria-modal="true" aria-labelledby="legalTitle"
    aria-describedby="legalBody" hidden>
    <div class="mm-modal__backdrop" data-close="true"></div>
    <div class="mm-modal__dialog" role="document">
      <header class="mm-modal__header">
        <h2 id="legalTitle" class="mm-modal__title">Titre</h2>
        <button class="mm-modal__close" type="button" aria-label="Fermer" data-close="true">‚úï</button>
      </header>
      <div id="legalBody" class="mm-modal__content" tabindex="0"></div>
      <footer class="mm-modal__footer">
        <button class="mm-btn" type="button" data-close="true">Fermer</button>
      </footer>
    </div>
  </div>

  <!-- Main Application Script -->
  <script defer src="./dist/app.min.js"></script>

  <!-- PROFILE MODAL -->
  <!-- Profile Drawer (nouveau pattern unifi√©) -->
  <div id="profileDrawer" class="profile-drawer" role="dialog" aria-modal="true" aria-labelledby="profileTitle" aria-describedby="profileA11yHelp" hidden>
    <div class="profile-overlay" data-close></div>
    <aside class="profile-panel">
      <!-- Header fixe avec avatar + identit√© + tabs -->
      <header id="profileHeader" class="profile-header">
        <div class="profile-header__top">
          <div>
            <p class="profile-header__eyebrow">Espace personnel</p>
            <p class="profile-header__subtitle">G√©rez votre pr√©sence sur MapMarket</p>
          </div>
          <button class="profile-close" type="button" aria-label="Fermer le profil" title="Fermer" data-close>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="profile-identity-card">
          <div class="profile-id">
            <button class="profile-avatar" id="profileAvatarBtn" aria-label="Changer l'avatar" type="button">
              <img id="profileAvatarImg" src="/uploads/avatars/default.jpg" alt="Avatar utilisateur" loading="lazy">
              <span class="profile-avatar-overlay" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
              </span>
            </button>
            <input id="profileAvatarInput" type="file" accept="image/*" hidden>
            <div class="profile-meta">
              <div class="profile-meta__primary">
                <h2 id="profileTitle" class="profile-name">Mon profil</h2>
                <span class="profile-badge" id="profileRoleBadge" hidden>Premium</span>
              </div>
              <p class="profile-email" id="profileEmail">email@example.com</p>
              <p class="profile-memberSince" id="profileMemberSince">Membre depuis ‚Äî</p>
              <div class="profile-meta__chips">
                <span class="profile-meta-chip">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M21 10c0 6-9 13-9 13S3 16 3 10a9 9 0 1 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span id="profileLocationChip">‚Äî</span>
                </span>
                <span class="profile-meta-chip">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                    <path d="M16 2v4"></path>
                    <path d="M8 2v4"></path>
                    <path d="M3 10h18"></path>
                  </svg>
                  <span id="profileAdsCountChip">0 annonces</span>
                </span>
              </div>
            </div>
            <button class="profile-icon-btn profile-icon-btn--danger profile-id__delete" id="profileDeleteBtn" aria-label="Supprimer mon compte">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
                <path d="M10 11v6"></path>
                <path d="M14 11v6"></path>
                <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
              </svg>
            </button>
          </div>
        </div>

        <nav id="profileTabs" class="profile-tabs" role="tablist" aria-label="Navigation du profil">
          <button role="tab" aria-selected="true" aria-controls="profilePanelOverview" id="tab-overview" data-tab="overview">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" class="icon icon-tab">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Profil</span>
          </button>
          <button role="tab" aria-selected="false" aria-controls="profilePanelListings" id="tab-listings" data-tab="listings">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" class="icon icon-tab">
              <rect x="3" y="4" width="18" height="16" rx="3"></rect>
              <path d="M7 8h10"></path>
              <path d="M7 12h4"></path>
            </svg>
            <span>Annonces</span>
          </button>
          <button role="tab" aria-selected="false" aria-controls="profilePanelAnalytics" id="tab-analytics" data-tab="analytics">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false" class="icon icon-tab">
              <path d="M3 3v18h18"></path>
              <rect x="7" y="12" width="3" height="6"></rect>
              <rect x="12" y="9" width="3" height="9"></rect>
              <rect x="17" y="6" width="3" height="12"></rect>
            </svg>
            <span>Analytique</span>
          </button>
          <span class="sr-only" id="profileSteps">√âtapes: 1/3 Profil, 2/3 Annonces, 3/3 Analytique</span>
        </nav>
      </header>

      <!-- Body avec panels -->
      <section class="profile-body">
        <!-- Panel 1: Aper√ßu -->
  <div id="profilePanelOverview" class="profile-panel-content profile-panel-content--fluid profile-panel-content--bare" role="tabpanel" aria-labelledby="tab-overview">
          <div class="profile-overview-grid">
            <article class="profile-card profile-card--form profile-card--accent">
              <div class="profile-card-head">
                <h3 class="profile-section-title">Informations personnelles</h3>
              </div>
              <form id="profileInfoForm" class="profile-form">
                <div class="profile-form-group">
                  <label for="profileNameInput">Nom</label>
                  <div class="profile-input-with-icon">
                    <input type="text" id="profileNameInput" name="name" autocomplete="name" required readonly>
                    <button type="button" class="profile-input-icon-btn" id="profileNameEditBtn" aria-label="Modifier le nom" title="Modifier">
                      <svg class="profile-input-icon profile-input-icon--edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                      </svg>
                      <svg class="profile-input-icon profile-input-icon--save" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                    </button>
                  </div>
                  <span class="profile-form-hint" id="profileNameHint">Utilisez votre nom public. Minimum 2 caract√®res.</span>
                </div>
                <p class="profile-form-feedback" id="profileInfoFeedback" role="status" aria-live="polite"></p>
                <div class="profile-actions" style="display: none;">
                  <button type="button" class="profile-btn profile-btn--ghost" id="profileCancelBtn" aria-label="Annuler et fermer">Annuler</button>
                  <button type="submit" class="profile-btn" id="profileInfoSubmit">Enregistrer</button>
                </div>
              </form>
            </article>

            <article class="profile-card profile-card--form profile-card--security">
              <div class="profile-card-head">
                <h3 class="profile-section-title">Mot de passe</h3>
                <p class="profile-section-subtitle">Gardez un compte s√ªr avec un mot de passe fort.</p>
              </div>
              <form id="profilePasswordForm" class="profile-form">
                <div class="profile-form-group">
                  <label for="profileCurrentPassword">Mot de passe actuel</label>
                  <div class="profile-input-with-icon profile-input-with-icon--double">
                    <input type="password" id="profileCurrentPassword" name="currentPassword" autocomplete="current-password" required readonly>
                    <button type="button" class="profile-input-icon-btn profile-input-icon-btn--cancel" id="profilePasswordCancelBtn" aria-label="Annuler" title="Annuler" style="display: none;">
                      <svg class="profile-input-icon profile-input-icon--cancel" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                      </svg>
                    </button>
                    <button type="button" class="profile-input-icon-btn" id="profilePasswordEditBtn" aria-label="Modifier le mot de passe" title="Modifier">
                      <svg class="profile-input-icon profile-input-icon--edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                      </svg>
                      <svg class="profile-input-icon profile-input-icon--save" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                        <polyline points="20 6 9 17 4 12"/>
                      </svg>
                    </button>
                  </div>
                  <span class="profile-form-error" id="currentPasswordError"></span>
                </div>
                <div class="profile-form-group" style="display: none;">
                  <label for="profileNewPassword">Nouveau mot de passe</label>
                  <input type="password" id="profileNewPassword" name="newPassword" minlength="8" autocomplete="new-password" required>
                  <span class="profile-form-hint">Minimum 8 caract√®res</span>
                  <span class="profile-form-error" id="newPasswordError"></span>
                </div>
                <div class="profile-form-group" style="display: none;">
                  <label for="profileConfirmPassword">Confirmer</label>
                  <input type="password" id="profileConfirmPassword" name="confirmPassword" minlength="8" autocomplete="new-password" required>
                  <span class="profile-form-error" id="confirmPasswordError"></span>
                </div>
                <p class="profile-form-feedback" id="profilePasswordFeedback" role="status" aria-live="polite"></p>
              </form>
            </article>

          </div>
        </div>

        <!-- Panel 2: Annonces -->
  <div id="profilePanelListings" class="profile-panel-content profile-panel-content--fluid profile-panel-content--bare" role="tabpanel" aria-labelledby="tab-listings" hidden>
          <div class="profile-card profile-card--listings">
            <div class="profile-card-head">
              <h3 class="profile-section-title">Vos annonces r√©centes</h3>
              <p class="profile-section-subtitle">Un aper√ßu rapide de vos publications actives et √† jour.</p>
            </div>
            <div class="profile-listings-grid" id="profileListingsGrid" role="list">
              <div class="profile-empty-state" id="profileListingsEmpty">
                <p>Aucune annonce publi√©e pour le moment.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel 3: Analytique -->
  <div id="profilePanelAnalytics" class="profile-panel-content profile-panel-content--fluid profile-panel-content--bare" role="tabpanel" aria-labelledby="tab-analytics" hidden>
          <!-- KPIs -->
          <div class="profile-kpis" id="profileKpis">
            <div class="profile-kpi">
              <span class="profile-kpi-label">Vues totales</span>
              <span class="profile-kpi-value" id="kpiTotalViews">0</span>
            </div>
            <div class="profile-kpi">
              <span class="profile-kpi-label">Favoris totaux</span>
              <span class="profile-kpi-value" id="kpiTotalFavorites">0</span>
            </div>
            <div class="profile-kpi">
              <span class="profile-kpi-label">Vues moy./annonce</span>
              <span class="profile-kpi-value" id="kpiAverageViews">0</span>
            </div>
            <div class="profile-kpi">
              <span class="profile-kpi-label">Valeur catalogue</span>
              <span class="profile-kpi-value" id="kpiInventoryValue">0 ‚Ç¨</span>
            </div>
          </div>

          <!-- Performance par cat√©gorie -->
          <div class="profile-card">
            <h3 class="profile-section-title">Performance par cat√©gorie</h3>
            <div class="profile-chart-bars" id="analyticsCategoryChart"></div>
          </div>

          <!-- Top annonces -->
          <div class="profile-card">
            <h3 class="profile-section-title">Top annonces</h3>
            <ul class="profile-top-ads" id="analyticsTopAds">
              <li>Aucune donn√©e</li>
            </ul>
          </div>

          <!-- R√©partition g√©ographique -->
          <div class="profile-card">
            <h3 class="profile-section-title">R√©partition g√©ographique</h3>
            <ul class="profile-geo-list" id="analyticsGeoList">
              <li>Aucune donn√©e</li>
            </ul>
          </div>
        </div>

      </section>
    </aside>
    <div id="profileDeleteConfirm" class="mm-confirm profile-confirm" hidden>
      <div class="mm-confirm__backdrop" data-confirm-close></div>
      <div class="mm-confirm__dialog" role="dialog" aria-modal="true" aria-labelledby="profileDeleteConfirmTitle">
        <div class="mm-confirm__icon" aria-hidden="true">‚ö†Ô∏è</div>
        <div class="mm-confirm__copy">
          <h3 id="profileDeleteConfirmTitle" class="mm-confirm__title">Supprimer le compte</h3>
          <p class="mm-confirm__message">
            Cette action est d√©finitive. Tapez <strong>SUPPRIMER</strong> pour confirmer et effacer toutes vos donn√©es.
          </p>
        </div>
        <label class="mm-confirm__label" for="profileDeleteConfirmInput">Confirmez en tapant "SUPPRIMER"</label>
  <input type="text" id="profileDeleteConfirmInput" class="mm-confirm__input" autocomplete="off" autocapitalize="characters" spellcheck="false" placeholder="SUPPRIMER" aria-required="true">
        <p class="profile-form-feedback mm-confirm__feedback" id="profileDeleteConfirmFeedback" role="status" aria-live="polite"></p>
        <div class="mm-confirm__actions">
          <button type="button" class="mm-confirm__btn mm-confirm__btn--ghost" id="profileDeleteCancelBtn" data-confirm-close>Annuler</button>
          <button type="button" class="mm-confirm__btn mm-confirm__btn--primary" id="profileDeleteConfirmBtn" disabled>Supprimer d√©finitivement</button>
        </div>
      </div>
    </div>
    <!-- Aide accessibilit√© pour le lecteur d'√©cran -->
    <p id="profileA11yHelp" class="sr-only">Ce panneau lat√©ral est un dialogue modal. Utilisez la touche Echap pour fermer. La navigation au clavier est cyclique dans le panneau.</p>
  </div>

  <!-- Profile Modal Script -->
  <script src="/js/profile-modal.js"></script>
  
  <!-- Recently Viewed Script -->
  <script src="/js/recently-viewed.js"></script>
</body>
</html>
